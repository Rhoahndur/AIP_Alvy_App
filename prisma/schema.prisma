generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Application {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  status    Status   @default(PENDING)

  beverageType BeverageType

  // Universal fields (all beverage types)
  brandName         String
  classType         String
  alcoholContent    String?
  netContents       String
  nameAddress       String
  governmentWarning String
  countryOfOrigin   String?

  // Wine-only fields
  appellation String?
  varietal    String?
  vintageDate String?

  // Image
  imageUrl      String
  imageFilename String

  // Relationships
  verificationResult VerificationResult?

  // Batch tracking
  batchId String?

  @@index([status])
  @@index([batchId])
  @@index([beverageType])
}

model VerificationResult {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  applicationId String      @unique
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  overallResult    OverallResult
  processingTimeMs Int
  ocrRawText       String
  ocrConfidence    Float

  fieldResults FieldResult[]

  agentNotes String?
  reviewedAt DateTime?
}

model FieldResult {
  id String @id @default(cuid())

  verificationResultId String
  verificationResult   VerificationResult @relation(fields: [verificationResultId], references: [id], onDelete: Cascade)

  fieldName      String
  expectedValue  String
  extractedValue String?
  autoResult     MatchResult
  confidence     Float

  agentOverride  MatchResult?
  overrideReason String?

  @@index([verificationResultId])
}

enum Status {
  PENDING
  VERIFIED
  MANUALLY_REVIEWED
}

enum BeverageType {
  SPIRITS
  WINE
  MALT_BEVERAGE
}

enum OverallResult {
  AUTO_PASS
  AUTO_FAIL
  MANUAL_PASS
  MANUAL_FAIL
}

enum MatchResult {
  MATCH
  MISMATCH
  PARTIAL
  NOT_FOUND
}
